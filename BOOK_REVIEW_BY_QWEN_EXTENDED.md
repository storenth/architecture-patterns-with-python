# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞ Python: —ç–≤–æ–ª—é—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–æ —Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–∏–≥–∏ –∏ –ø—É—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

–ö–Ω–∏–≥–∞ ¬´Architecture Patterns with Python¬ª (Cosmic Python) –•–∞—Ä—Ä–∏ –ü–µ—Ä—Å–∏–≤–∞–ª—è –∏ –ë–æ–±–∞ –ì—Ä–µ–≥–æ—Ä–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é —ç–≤–æ–ª—é—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** —á–µ—Ä–µ–∑ 13 –≥–ª–∞–≤. –ê–≤—Ç–æ—Ä—ã —Å—Ç—Ä–æ—è—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø–∞—Å–æ–≤ –º–µ–±–µ–ª–∏ (allocation service), –Ω–∞—á–∏–Ω–∞—è —Å —á–∏—Å—Ç–æ–π –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—è —Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –≥–æ—Ç–æ–≤–æ–π –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É.

---

## üî∑ –ß–∞—Å—Ç—å I: –§—É–Ω–¥–∞–º–µ–Ω—Ç ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ì–ª–∞–≤–∞ 1: Domain Modeling ‚Äî —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å, —Å–≤–æ–±–æ–¥–Ω–∞—è –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –∏ –º–µ–Ω—è—Ç—å –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# Entity ‚Äî –æ–±—ä–µ–∫—Ç —Å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å—é, —Å–æ—Ö—Ä–∞–Ω—è—é—â–µ–π—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏
class Batch:
    def __init__(self, reference: str, sku: str, qty: int, eta: Optional[date]):
        self.reference = reference  # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
        self.sku = sku
        self._purchased_quantity = qty
        self._allocations = set()  # –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# Value Object ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
@dataclass(frozen=True)
class OrderLine:
    orderid: str
    sku: str
    qty: int  # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –ø–æ–ª—è = –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç

# Domain Service ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∞—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
def allocate(line: OrderLine, batches: List[Batch]) -> str:
    batch = next(b for b in sorted(batches) if b.can_allocate(line))
    batch.allocate(line)
    return batch.reference
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å –º–∞–≥–∞–∑–∏–Ω –∏–≥—Ä—É—à–µ–∫. –£ –∫–∞–∂–¥–æ–π –∫–æ—Ä–æ–±–∫–∏ –µ—Å—Ç—å —è—Ä–ª—ã–∫ —Å –Ω–æ–º–µ—Ä–æ–º (—ç—Ç–æ `reference` ‚Äî –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∫–æ—Ä–æ–±–∫–∏). –ï—Å–ª–∏ —Ç—ã –ø–æ–º–µ–Ω—è–µ—à—å –∏–≥—Ä—É—à–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ä–æ–±–∫–∏ ‚Äî —ç—Ç–æ –≤—Å—ë —Ç–∞ –∂–µ –∫–æ—Ä–æ–±–∫–∞ (—Å—É—â–Ω–æ—Å—Ç—å/Entity). –ê —Å–∞–º–∞ –∏–≥—Ä—É—à–∫–∞ –±–µ–∑ –∫–æ—Ä–æ–±–∫–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: —Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä, –º–∞—Ç–µ—Ä–∏–∞–ª (–æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ/Value Object). –ï—Å–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å —Ö–æ—Ç—å –æ–¥–Ω—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É ‚Äî —ç—Ç–æ —É–∂–µ –¥—Ä—É–≥–∞—è –∏–≥—Ä—É—à–∫–∞.

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:** –ê–≤—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç —Å —á–∏—Å—Ç–æ–π –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å: —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ, –∞ –Ω–µ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏.

---

### –ì–ª–∞–≤–∞ 2: Repository Pattern ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DIP) –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: –º–æ–¥–µ–ª—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç ORM. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ORM –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –ü–æ—Ä—Ç (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è)
class AbstractRepository(abc.ABC):
    @abc.abstractmethod
    def add(self, batch: model.Batch): ...
    @abc.abstractmethod
    def get(self, reference) -> model.Batch: ...

# –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤
class FakeRepository(AbstractRepository):
    def __init__(self, batches):
        self._batches = set(batches)
    
    def add(self, batch):
        self._batches.add(batch)
    
    def get(self, reference):
        return next(b for b in self._batches if b.reference == reference)

# –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
class SqlAlchemyRepository(AbstractRepository):
    def __init__(self, session):
        self.session = session
    
    def get(self, reference):
        return self.session.query(model.Batch).filter_by(reference=reference).one()
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å. –¢—ã –≥–æ–≤–æ—Ä–∏—à—å: ¬´–î–∞–π –º–Ω–µ –∫–Ω–∏–≥—É "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä"¬ª, –∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å —Å–∞–º —Ä–µ—à–∞–µ—Ç, –≥–¥–µ –µ—ë –∏—Å–∫–∞—Ç—å ‚Äî –Ω–∞ –ø–æ–ª–∫–µ, –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –∏–∑ –¥—Ä—É–≥–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –¢–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–µ–π.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤–æ–±–æ–¥–Ω–∞ –æ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ú—ã –º–æ–∂–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã —Å `FakeRepository` –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ª—é–±–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

### –ì–ª–∞–≤–∞ 3: –°–≤—è–∑–∏ –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –•–æ—Ä–æ—à–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —É–º–µ–Ω—å—à–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å (coupling) –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –∏—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (cohesion).

**–ü—Ä–∏–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
```python
# –ü–ª–æ—Ö–æ: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
def sync(source, dest):
    for folder, _, files in os.walk(source):
        for fn in files:
            shutil.copyfile(...)

# –•–æ—Ä–æ—à–æ: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ "—á—Ç–æ" –∏ "–∫–∞–∫"
def determine_actions(src_hashes, dst_hashes, src_folder, dst_folder):
    for sha, filename in src_hashes.items():
        if sha not in dst_hashes:
            yield 'copy', src_folder/filename, dst_folder/filename
        elif dst_hashes[sha] != filename:
            yield 'move', dst_folder/dst_hashes[sha], dst_folder/filename
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å –∫–æ–Ω—Ñ–µ—Ç—ã –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏ –≤ –¥—Ä—É–≥—É—é. –•–æ—Ä–æ—à–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã —Å–Ω–∞—á–∞–ª–∞ —Ä–µ—à–∞–µ—à—å *–∫–∞–∫–∏–µ* –∫–æ–Ω—Ñ–µ—Ç—ã –∫—É–¥–∞ –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞), –∞ –ø–æ—Ç–æ–º —É–∂–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∏—Ö –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–µ—à—å (—Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π). –¢–∞–∫ —Ç—ã –º–æ–∂–µ—à—å —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ –±—É–º–∞–≥–µ, –Ω–µ —Ç—Ä–æ–≥–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—ã.

**–°–≤—è–∑—å —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:** –≠—Ç–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –ª–µ–∂–∏—Ç –≤ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ ‚Äî –º—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–µ–ª—è–µ–º *—á—Ç–æ* –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç *–∫–∞–∫* —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å.

---

### –ì–ª–∞–≤–∞ 4: Service Layer ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (use cases), –∏–∑–æ–ª–∏—Ä—É—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –¢–∏–ø–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è
def allocate(
    orderid: str, 
    sku: str, 
    qty: int, 
    uow: unit_of_work.AbstractUnitOfWork
) -> str:
    line = OrderLine(orderid, sku, qty)
    with uow:  # Unit of Work —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
        product = uow.products.get(sku=line.sku)
        if product is None:
            raise InvalidSku(f'Invalid sku {line.sku}')
        batchref = product.allocate(line)
        uow.commit()  # –Ø–≤–Ω—ã–π –∫–æ–º–º–∏—Ç ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return batchref
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π ‚Äî –∫–∞–∫ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ. –¢—ã –≥–æ–≤–æ—Ä–∏—à—å: ¬´–•–æ—á—É —Å—Ç–µ–π–∫¬ª, –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –ø–æ–≤–∞—Ä—É (–¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å), —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –≤—Å—ë –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–µ–±–µ –≥–æ—Ç–æ–≤–æ–µ –±–ª—é–¥–æ. –¢–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø–æ–≤–∞—Ä –∂–∞—Ä–∏–ª –º—è—Å–æ.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å —á—ë—Ç–∫–∏–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É. –í–µ–±-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å—Ç–∞–ª–∏ —Ç–æ–Ω–∫–∏–º–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏:
```python
@app.route("/allocate", methods=['POST'])
def allocate_endpoint():
    uow = SqlAlchemyUnitOfWork()
    batchref = services.allocate(
        request.json['orderid'],
        request.json['sku'],
        request.json['qty'],
        uow
    )
    return jsonify({'batchref': batchref}), 201
```

---

### –ì–ª–∞–≤–∞ 5: TDD in High Gear and Low Gear ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –¢–µ—Å—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è –¥–∞—é—Ç –ª—É—á—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏, —á–µ–º —Ç–µ—Å—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–æ–º–µ–Ω–∞ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –ø–∏—Ä–∞–º–∏–¥—ã:**
- 70% ‚Äî —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è —Å `FakeRepository`
- 20% ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ UoW
- 10% ‚Äî end-to-end —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ API

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è:**
```python
def test_allocate_returns_allocation():
    uow = FakeUnitOfWork()
    services.add_batch("batch1", "COMPLICATED-LAMP", 100, None, uow)
    result = services.allocate("o1", "COMPLICATED-LAMP", 10, uow)
    assert result == "batch1"
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã —É—á–∏—à—å—Å—è –≤–æ–¥–∏—Ç—å –º–∞—à–∏–Ω—É. –°–Ω–∞—á–∞–ª–∞ —Ç—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å—Å—è –Ω–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–µ (—Ç–µ—Å—Ç—ã –¥–æ–º–µ–Ω–∞ ‚Äî "–Ω–∏–∑–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞"), –ø–æ—Ç–æ–º –µ–∑–¥–∏—à—å –ø–æ –ø—É—Å—Ç–æ–π –ø–∞—Ä–∫–æ–≤–∫–µ (—Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è ‚Äî "–≤—ã—Å–æ–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞"), –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –≤—ã–µ–∑–∂–∞–µ—à—å –≤ –≥–æ—Ä–æ–¥ (end-to-end —Ç–µ—Å—Ç—ã). –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—ã –ø—Ä–æ–≤–æ–¥–∏—à—å –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ ‚Äî —Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ —É—á–∏—Ç—å—Å—è.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –ú—ã –º–æ–∂–µ–º —Å–º–µ–ª–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è —Ç–µ—Å—Ç—ã ‚Äî –æ–Ω–∏ –∑–∞–≤–∏—Å—è—Ç —Ç–æ–ª—å–∫–æ –æ—Ç —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è.

---

### –ì–ª–∞–≤–∞ 6: Unit of Work Pattern ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –∞—Ç–æ–º–∞—Ä–Ω–æ.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π UoW —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
class AbstractUnitOfWork(abc.ABC):
    products: repository.AbstractRepository

    def __enter__(self): 
        return self
    
    def __exit__(self, *args):
        self.rollback()
    
    @abc.abstractmethod
    def commit(self): ...
    @abc.abstractmethod
    def rollback(self): ...

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
def change_batch_quantity(ref: str, qty: int, uow: AbstractUnitOfWork):
    with uow:  # –í—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ
        batch = uow.products.get_by_batchref(ref)
        batch.change_quantity(qty)
        while batch.available_quantity < 0:
            line = batch.deallocate_one()
        uow.commit()  # –Ø–≤–Ω—ã–π –∫–æ–º–º–∏—Ç ‚Äî —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–µ—à—å –∫–æ–Ω—Ñ–µ—Ç—ã –∏–∑ –æ–¥–Ω–æ–π –∫–æ—Ä–æ–±–∫–∏ –≤ –¥—Ä—É–≥—É—é. –ï–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –±–µ—Ä—ë—à—å –∫–æ–Ω—Ñ–µ—Ç—É –∏–∑ –ø–µ—Ä–≤–æ–π –∫–æ—Ä–æ–±–∫–∏ –ò —Å—Ä–∞–∑—É –∫–ª–∞–¥—ë—à—å –≤–æ –≤—Ç–æ—Ä—É—é. –ï—Å–ª–∏ —É—Ä–æ–Ω–∏—à—å –∫–æ–Ω—Ñ–µ—Ç—É –ø–æ –¥–æ—Ä–æ–≥–µ ‚Äî –≤—Å—ë –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –∏ –∫–æ–Ω—Ñ–µ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –±—ã–ª–∏. –ù–∏–∫–∞–∫–∏—Ö "–ø–æ–ª—É-–ø–µ—Ä–µ–ª–æ–∂–µ–Ω–Ω—ã—Ö" –∫–æ–Ω—Ñ–µ—Ç!

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –æ–¥–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (`AbstractUnitOfWork`), –∞ –Ω–µ –æ—Ç –¥–≤—É—Ö (`Repository` + `Session`). –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ.

---

### –ì–ª–∞–≤–∞ 7: Aggregates and Consistency Boundaries ‚Äî –≥—Ä–∞–Ω–∏—Ü—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ê–≥—Ä–µ–≥–∞—Ç ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –ê–≥—Ä–µ–≥–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—É, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
class Product:  # –ê–≥—Ä–µ–≥–∞—Ç-–∫–æ—Ä–µ–Ω—å
    def __init__(self, sku: str, batches: List[Batch], version_number: int = 0):
        self.sku = sku
        self.batches = batches  # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã
        self.version_number = version_number  # –î–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    
    def allocate(self, line: OrderLine) -> str:
        # –í—Å—è –ª–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–¥–µ—Å—å
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç: "–Ω–µ–ª—å–∑—è –≤—ã–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏"
        batch = next(b for b in sorted(self.batches) if b.can_allocate(line))
        batch.allocate(line)
        self.version_number += 1  # –î–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        return batch.reference
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ê–≥—Ä–µ–≥–∞—Ç ‚Äî –∫–∞–∫ –∫–æ—Ä–æ–±–∫–∞ —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –õ–µ–≥–æ. –í–Ω—É—Ç—Ä–∏ –º–Ω–æ–≥–æ –¥–µ—Ç–∞–ª–µ–π (–±–∞—Ç—á–∏), –Ω–æ —Ç—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å–æ –≤—Å–µ–π –∫–æ—Ä–æ–±–∫–æ–π —Ü–µ–ª–∏–∫–æ–º. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å ‚Äî –±–µ—Ä—ë—à—å –≤—Å—é –∫–æ—Ä–æ–±–∫—É, –º–µ–Ω—è–µ—à—å –¥–µ—Ç–∞–ª–∏ –≤–Ω—É—Ç—Ä–∏, –∏ —Å—Ç–∞–≤–∏—à—å –æ–±—Ä–∞—Ç–Ω–æ. –ù–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –Ω–µ –º–æ–∂–µ—Ç —Ç—Ä–æ–≥–∞—Ç—å —ç—Ç—É –∫–æ—Ä–æ–±–∫—É, –ø–æ–∫–∞ —Ç—ã —Å –Ω–µ–π —Ä–∞–±–æ—Ç–∞–µ—à—å.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –ú—ã –ø–µ—Ä–µ—à–ª–∏ –æ—Ç `BatchRepository` –∫ `ProductRepository`, –ø–æ—Ç–æ–º—É —á—Ç–æ `Product` —Å—Ç–∞–ª –∞–≥—Ä–µ–≥–∞—Ç–æ–º-–∫–æ—Ä–Ω–µ–º. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞: —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö SKU, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –≤—Å—é —Ç–∞–±–ª–∏—Ü—É `batches`.

---

## üî∑ –ß–∞—Å—Ç—å II: –°–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ì–ª–∞–≤–∞ 8: Events and the Message Bus ‚Äî —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ñ–∞–∫—Ç—ã, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π).

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –°–æ–±—ã—Ç–∏–µ –∫–∞–∫ –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
@dataclass
class OutOfStock(Event):
    sku: str

# –ú–æ–¥–µ–ª—å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è
class Product:
    def allocate(self, line: OrderLine) -> str:
        try:
            # ...–ª–æ–≥–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
        except StopIteration:
            self.events.append(OutOfStock(sku=line.sku))  # –ù–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ!
            return None

# –®–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
EVENT_HANDLERS = {
    OutOfStock: [send_out_of_stock_notification],
}

def handle(event: Event, uow: UnitOfWork):
    for handler in EVENT_HANDLERS[type(event)]:
        try:
            handler(event, uow=uow)  # –û—à–∏–±–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –Ω–µ –ª–æ–º–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        except Exception:
            logger.exception('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è')
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ö–æ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ, –∫–∞—Å—Å–∏—Ä –Ω–µ –±–µ–∂–∏—Ç —Å–∞–º –∑–≤–æ–Ω–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫—É. –û–Ω –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏—Ç —Ç–∞–±–ª–∏—á–∫—É "–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∫–æ–Ω—Ñ–µ—Ç—ã". –ê –∫–ª–∞–¥–æ–≤—â–∏–∫, —É–≤–∏–¥–µ–≤ —Ç–∞–±–ª–∏—á–∫—É, —Å–∞–º —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å ‚Äî –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—é —à–æ–∫–æ–ª–∞–¥. –¢–∞–±–ª–∏—á–∫–∞ ‚Äî —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –ú—ã –ø–µ—Ä–µ—à–ª–∏ –æ—Ç –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥–∞ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è. –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚Äî –Ω–µ —á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∞ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ñ–∞–∫—Ç –Ω–µ—Ö–≤–∞—Ç–∫–∏ –∑–∞–ø–∞—Å–æ–≤.

---

### –ì–ª–∞–≤–∞ 9: –í—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ï—Å–ª–∏ –≤—Å—ë –≤ —Å–∏—Å—Ç–µ–º–µ –≤—ã—Ä–∞–∂–µ–Ω–æ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã, —Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –¥–µ–ª–∞–µ—Ç –µ—ë –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –í—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
@dataclass
class Allocate(Command):
    orderid: str
    sku: str
    qty: int

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏
def allocate(cmd: Allocate, uow: AbstractUnitOfWork):
    line = OrderLine(cmd.orderid, cmd.sku, cmd.qty)
    with uow:
        product = uow.products.get(sku=line.sku)
        product.allocate(line)
        uow.commit()

# –®–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å
def handle(message: Message, uow: AbstractUnitOfWork):
    queue = [message]
    while queue:
        message = queue.pop(0)
        if isinstance(message, Event):
            handle_event(message, queue, uow)
        elif isinstance(message, Command):
            handle_command(message, queue, uow)
        queue.extend(uow.collect_new_events())
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ –Ω–∞ –≤—Ö–æ–¥–µ –≤ –¥–æ–º. –ö—É—Ä—å–µ—Ä –±—Ä–æ—Å–∞–µ—Ç –ø–∏—Å—å–º–æ (—Å–æ–±—ã—Ç–∏–µ) –≤ —è—â–∏–∫ –∏ —É—Ö–æ–¥–∏—Ç ‚Äî –µ–º—É –Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –∫—Ç–æ-—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –ø–∏—Å—å–º–æ. –ê –∂–∏–ª—å—Ü—ã –¥–æ–º–∞ –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —è—â–∏–∫ –∫–æ–≥–¥–∞ –∏–º —É–¥–æ–±–Ω–æ –∏ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø–∏—Å—å–º–∞ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫) –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ).

---

### –ì–ª–∞–≤–∞ 10: Commands vs Events ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –ö–æ–º–∞–Ω–¥—ã –≤—ã—Ä–∞–∂–∞—é—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ ("—Å–¥–µ–ª–∞–π —á—Ç–æ-—Ç–æ"), —Å–æ–±—ã—Ç–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ñ–∞–∫—Ç—ã ("—á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ"). –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ –∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π; —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ö–æ–º–∞–Ω–¥–∞ (Command) | –°–æ–±—ã—Ç–∏–µ (Event) |
|----------------|-------------------|-----------------|
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º–µ —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ | –§–∞–∫—Ç –æ –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–µ–º |
| –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –ü–æ–≤–µ–ª–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏–µ (`Allocate`) | –ü—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è (`Allocated`) |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –ü—Ä–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—ã = –æ—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã | –ü—Ä–æ–≤–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è = –ª–æ–≥–∏—Ä—É–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º |
| –û—Ç–ø—Ä–∞–≤–∫–∞ | –û–¥–Ω–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é | –í—Å–µ–º –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–º |

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ö–æ–º–∞–Ω–¥–∞ ‚Äî –∫–∞–∫ –ø—Ä–∏–∫–∞–∑ "–ü—Ä–∏–Ω–µ—Å–∏ –≤–æ–¥—É!". –ï—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω—ë—Å ‚Äî –∑–∞–¥–∞—á–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°–æ–±—ã—Ç–∏–µ ‚Äî –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ "–í–æ–¥–∞ –ø—Ä–∏–Ω–µ—Å–µ–Ω–∞". –ï—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ —É—Å–ª—ã—à–∞–ª ‚Äî –≤–æ–¥–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–Ω–µ—Å–µ–Ω–∞, –ø—Ä–æ—Å—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã: –æ—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–∫–æ–º–∞–Ω–¥–∞) –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –∞ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π) –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

---

### –ì–ª–∞–≤–∞ 11: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –í–Ω–µ—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏ (temporal coupling). –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –∏ –º–æ–∂–µ—Ç —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –í—Ö–æ–¥—è—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (Redis)
def handle_change_batch_quantity(m):
    data = json.loads(m['data'])
    cmd = ChangeBatchQuantity(ref=data['batchref'], qty=data['qty'])
    messagebus.handle(cmd, uow=SqlAlchemyUnitOfWork())

# –ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
def publish_allocated_event(event: Allocated, _):
    redis.publish('line_allocated', json.dumps(asdict(event)))
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –≤ —Ç–≤–æ—ë–º –¥–æ–º–µ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç (—Å–µ—Ä–≤–∏—Å–æ–≤). –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∫—Ä–∏—á–∞—Ç—å –∏–∑ –∫–æ–º–Ω–∞—Ç—ã –≤ –∫–æ–º–Ω–∞—Ç—É ("–Ø –∑–∞–∫–æ–Ω—á–∏–ª —É–±–æ—Ä–∫—É!"), —Ç—ã –∫–ª–∞–¥—ë—à—å –∑–∞–ø–∏—Å–∫—É –Ω–∞ –æ–±—â–∏–π —Å—Ç–æ–ª (—à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π). –ö–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∫–∏, –∫–æ–≥–¥–∞ –µ–º—É —É–¥–æ–±–Ω–æ, –∏ –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ-—Å–≤–æ–µ–º—É. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª –∑–∞–ø–∏—Å–∫—É ‚Äî –æ–Ω –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∑–∂–µ.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –ú—ã –ø–µ—Ä–µ—à–ª–∏ –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π "–±–æ–ª—å—à–æ–π –∫–æ–º–æ–∫ –≥—Ä—è–∑–∏") –∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏: —Å–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø–∞—Å–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

---

### –ì–ª–∞–≤–∞ 12: CQRS ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –û–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è (queries) –∏ –∑–∞–ø–∏—Å–∏ (commands) –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ò—Ö —Å–ª–µ–¥—É–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# –ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
def allocate(cmd: Allocate, uow: UnitOfWork):
    with uow:
        product = uow.products.get(cmd.sku)
        product.allocate(OrderLine(cmd.orderid, cmd.sku, cmd.qty))
        uow.commit()  # –û–±–Ω–æ–≤–ª—è–µ–º "–∑–∞–ø–∏—Å—ã–≤–∞—é—â—É—é" –º–æ–¥–µ–ª—å

# –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å
def allocations(orderid: str, uow: UnitOfWork):
    # –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ –¥–∂–æ–π–Ω–æ–≤ ‚Äî –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ —Å–µ–∫—É–Ω–¥
    return list(uow.session.execute(
        "SELECT sku, batchref FROM allocations_view WHERE orderid = :orderid",
        dict(orderid=orderid)
    ))

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —á—Ç–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π
def add_allocation_to_read_model(event: Allocated, uow: UnitOfWork):
    uow.session.execute(
        "INSERT INTO allocations_view VALUES (:orderid, :sku, :batchref)",
        dict(orderid=event.orderid, sku=event.sku, batchref=event.batchref)
    )
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –µ—Å—Ç—å –¥–≤–∞ –æ—Ç–¥–µ–ª–∞:
1. **–û—Ç–¥–µ–ª –ø—Ä–∏—ë–º–∞ –∫–Ω–∏–≥** ‚Äî —Å—Ç—Ä–æ–≥–∏–π, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—É—é –∫–Ω–∏–≥—É, —Å—Ç–∞–≤–∏—Ç —à—Ç–∞–º–ø—ã, –∑–∞–Ω–æ—Å–∏—Ç –≤ –≥–ª–∞–≤–Ω—ã–π –∂—É—Ä–Ω–∞–ª (–∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å)
2. **–ß–∏—Ç–∞–ª—å–Ω—ã–π –∑–∞–ª** ‚Äî –∑–¥–µ—Å—å –ª–µ–∂–∞—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –∫–Ω–∏–≥—É (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —á—Ç–µ–Ω–∏—è)

–ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–∞—è –∫–Ω–∏–≥–∞, —Å–Ω–∞—á–∞–ª–∞ –µ—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤ –ø–µ—Ä–≤–æ–º –æ—Ç–¥–µ–ª–µ, –∞ –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è—é—Ç –∫–∞—Ç–∞–ª–æ–≥–∏ –≤–æ –≤—Ç–æ—Ä–æ–º. –ù–æ —á–∏—Ç–∞—Ç–µ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–æ–¥—è—Ç –≤ –æ—Ç–¥–µ–ª –ø—Ä–∏—ë–º–∞ ‚Äî –æ–Ω–∏ –ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º–∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–∞–ø–∏—Å–∏. –ú–æ–¥–µ–ª—å —á—Ç–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∞ –∏–ª–∏ –¥–∞–∂–µ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redis), –Ω–µ –≤–ª–∏—è—è –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏.

---

### –ì–ª–∞–≤–∞ 13: Dependency Injection ‚Äî –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å:** –¢–æ—á–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (composition root) ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –º—ã —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Å –∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏. –í Python —ç—Ç–æ –æ–±—ã—á–Ω–æ —Å–∫—Ä–∏–ø—Ç `bootstrap.py`.

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
# bootstrap.py ‚Äî —Ç–æ—á–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
def bootstrap(
    start_orm: bool = True,
    uow: AbstractUnitOfWork = SqlAlchemyUnitOfWork(),
    notifications: AbstractNotifications = EmailNotifications(),
    publish: Callable = redis_eventpublisher.publish,
) -> MessageBus:
    if start_orm:
        orm.start_mappers()
    
    # –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    injected_command_handlers = {
        Allocate: lambda cmd: handlers.allocate(cmd, uow),
        CreateBatch: lambda cmd: handlers.add_batch(cmd, uow),
        # ...
    }
    
    return MessageBus(
        uow=uow,
        command_handlers=injected_command_handlers,
        event_handlers=injected_event_handlers,
    )

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–æ—á–∫–µ –≤—Ö–æ–¥–∞
bus = bootstrap.bootstrap()
bus.handle(Allocate("order1", "SKU-123", 10))
```

**–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞:**  
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä. –¢–æ—á–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≥–æ–≤–æ—Ä–∏—Ç: "–í–æ–∑—å–º–∏ –∫—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ ‚Ññ5 –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏ –µ–≥–æ –∫ —Å–∏–Ω–µ–º—É –±–ª–æ–∫—É ‚Ññ3". –°–∞–º–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, –Ω–æ –±–µ–∑ –Ω–µ—ë —Ç—ã –Ω–µ —Å–æ–±–µ—Ä—ë—à—å –º–æ–¥–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –¢–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ª–µ–≥–∫–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ —Ñ–µ–π–∫–∏) –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è dev/staging/prod).

---

## üöÄ –ü—É—Ç—å –∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ Team Lead: –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç–∏ –∑–Ω–∞–Ω–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∑—Ä–µ–ª–æ—Å—Ç—å —á–µ—Ä–µ–∑ —ç–≤–æ–ª—é—Ü–∏—é

–ê–≤—Ç–æ—Ä—ã –∫–Ω–∏–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é —ç–≤–æ–ª—é—Ü–∏—é**, –∞ –Ω–µ "–∏–¥–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –Ω—É–ª—è":

```
–î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –Ω–∞–¥ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º)
Repository Pattern 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é)
Service Layer 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)
Unit of Work 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏)
Aggregates 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
Domain Events + Message Bus 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)
Commands vs Events 
    ‚Üì (–¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é)
External Events 
    ‚Üì (–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
CQRS
```

**–í—ã–≤–æ–¥ –¥–ª—è —Ç–µ—Ö–ª–∏–¥–∞:** –ù–µ –Ω—É–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å—Ä–∞–∑—É. –ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –º–µ—Ä–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º:
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã? ‚Üí –î–æ–±–∞–≤—å—Ç–µ `Repository` —Å —Ñ–µ–π–∫–∞–º–∏
- –°–ª–æ–∂–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö? ‚Üí –î–æ–±–∞–≤—å—Ç–µ `Service Layer`
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º? ‚Üí –í–Ω–µ–¥—Ä–∏—Ç–µ `Aggregates`
- –°–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã? ‚Üí –î–æ–±–∞–≤—å—Ç–µ `Domain Events`

### 2. –Ø–∑—ã–∫ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –±–∏–∑–Ω–µ—Å–æ–º

–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø DDD ‚Äî **–µ–¥–∏–Ω—ã–π —è–∑—ã–∫ (ubiquitous language)**. –í—Å–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ –∫–æ–¥–µ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–º –±–∏–∑–Ω–µ—Å–∞:

```python
# –ü–ª–æ—Ö–æ ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
def process_order(order_id, product_id, quantity):
    db.execute("UPDATE inventory SET stock = stock - ? WHERE id = ?", 
               (quantity, product_id))

# –•–æ—Ä–æ—à–æ ‚Äî –±–∏–∑–Ω–µ—Å-—Ç–µ—Ä–º–∏–Ω—ã
def allocate(line: OrderLine, batches: List[Batch]) -> str:
    # "allocate" ‚Äî —Ç–µ—Ä–º–∏–Ω –∏–∑ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø–∞—Å–æ–≤
    # "batch" ‚Äî —Ç–µ—Ä–º–∏–Ω –∏–∑ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
    # "OrderLine" ‚Äî —Ç–µ—Ä–º–∏–Ω –∏–∑ –∑–∞–∫–∞–∑–æ–≤
```

**–í—ã–≤–æ–¥ –¥–ª—è —Ç–µ—Ö–ª–∏–¥–∞:** –£–º–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Äî –∫–ª—é—á–µ–≤–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ –∫–Ω–∏–≥–∏ –¥–∞—é—Ç –≤–∞–º —Å–ª–æ–≤–∞—Ä—å –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞.

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ê–≤—Ç–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ—Å—Ç—ã –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏, –Ω–æ –∏ –∫–∞–∫ **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:

- –¢–µ—Å—Ç—ã –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≥—Ä–∞–Ω–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤
- –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –¢–µ—Å—Ç—ã —Å —Ñ–µ–π–∫–∞–º–∏ ‚Üí –≤—ã—è–≤–ª—è—é—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–í—ã–≤–æ–¥ –¥–ª—è —Ç–µ—Ö–ª–∏–¥–∞:** –ó–¥–æ—Ä–æ–≤–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –ø–∏—Ä–∞–º–∏–¥–∞ (70% —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è) ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞", –∞ –ø—Ä–∏–∑–Ω–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –ï—Å–ª–∏ —É –≤–∞—Å 80% –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

### 4. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è

–°–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º ‚Äî **–≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å**:

```
–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤: 
  –°–µ—Ä–≤–∏—Å –ê ‚Üí (–∂–¥—ë—Ç) ‚Üí –°–µ—Ä–≤–∏—Å –ë ‚Üí (–∂–¥—ë—Ç) ‚Üí –°–µ—Ä–≤–∏—Å –í
  –ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ –°–µ—Ä–≤–∏—Å –ë —É–ø–∞–ª, –≤—Å—ë —Ü–µ–ø–æ—á–∫–∞ –ª–æ–º–∞–µ—Ç—Å—è

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è:
  –°–µ—Ä–≤–∏—Å –ê ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ ‚Üí —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  –°–µ—Ä–≤–∏—Å –ë ‚Üí –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ –º–æ–∂–µ—Ç
  –°–µ—Ä–≤–∏—Å –í ‚Üí –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ –º–æ–∂–µ—Ç
  –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
```

**–í—ã–≤–æ–¥ –¥–ª—è —Ç–µ—Ö–ª–∏–¥–∞:** –ü—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤—Å–µ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ: "–ú–æ–∂–µ—Ç –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ, –µ—Å–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?" –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∫–∞—Å–∫–∞–¥–Ω—ã–º —Å–±–æ—è–º.

---

## üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–µ—à–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–±–ª–µ–º

–ö–Ω–∏–≥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ –Ω–∞–±–æ—Ä "–∫—Ä—É—Ç—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤", –∞ **—ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –ø—É—Ç—å** –æ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –∫ —Å–ª–æ–∂–Ω–æ–π:

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–º–µ–Ω–∞** ‚Äî –º–æ–¥–µ–ª–∏—Ä—É–π—Ç–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã, –∞ –Ω–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î
2. **–ó–∞—â–∏—Ç–∏—Ç–µ –º–æ–¥–µ–ª—å** ‚Äî –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** ‚Äî `Repository`, `UoW`, `Service Layer`
4. **–†–∞–∑–¥–µ–ª—è–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî —á–µ—Ä–µ–∑ `Aggregates` –∏ `Domain Events`
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∞** ‚Äî —á–µ—Ä–µ–∑ `CQRS` –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

**–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ç–µ—Ö–ª–∏–¥–∞:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã", –∞ –ø—Ä–æ **—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é**. –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ª–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—â–∏ –ª—ë–≥–∫–∏–º–∏, –∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ‚Äî —Ç—Ä—É–¥–Ω—ã–º–∏. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥–µ –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞, –Ω–µ –±–æ—è—Å—å —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

–ö–∞–∫ –≥–æ–≤–æ—Ä—è—Ç –∞–≤—Ç–æ—Ä—ã: *"–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä—É–¥–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∑–∂–µ. –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ª–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—â–∏ –ª—ë–≥–∫–∏–º–∏, –∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ‚Äî —Ç—Ä—É–¥–Ω—ã–º–∏."*